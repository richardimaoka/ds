<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]>
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<![endif]-->
<meta content="width=device-width, initial-scale=1.0" name="viewport">
<meta content="Asciidoctor 1.5.2" name="generator">
<title>DS201: DataStax Enterprise Foundations of Apache Cassandra</title>
<style>/* Asciidoctor default stylesheet | MIT License | http://asciidoctor.org */
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section,summary{display:block}
audio,canvas,video{display:inline-block}
audio:not([controls]){display:none;height:0}
[hidden],template{display:none}
script{display:none!important}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
body{margin:0;}
a{background:transparent}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
input[type="search"]{-webkit-appearance:textfield;-moz-box-sizing:content-box;-webkit-box-sizing:content-box;box-sizing:content-box}
input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*:before,*:after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{color:rgba(0,0,0,.8); background:#fafafa;padding:0;margin:0;font-family:"Helvetica Neue",  helvetica, arial, verdana, sans-serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
#map_canvas img,#map_canvas embed,#map_canvas object,.map_canvas img,.map_canvas embed,.map_canvas object{max-width:none!important}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
.antialiased,body{-webkit-font-smoothing:antialiased}
img{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
p.lead,.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{font-size:1.21875em;line-height:1.6}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0;direction:ltr}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:none}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Helvetica Neue", helvetica, arial,sans-serif;font-weight:300;font-style:normal;color:#BC5E2E;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #ddddd8;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol,ul.no-bullet,ol.no-bullet{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.no-bullet{list-style:none}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite:before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media only screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede}
table thead,table tfoot{background:#f7f8f7;font-weight:bold}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt,table tr:nth-of-type(even){background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{display:table-cell;line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.clearfix:before,.clearfix:after,.float-group:before,.float-group:after{content:" ";display:table}
.clearfix:after,.float-group:after{clear:both}
*:not(pre)>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background-color:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre,pre>code{line-height:1.45;color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;text-rendering:optimizeSpeed}
.keyseq{color:rgba(51,51,51,.8)}
kbd{display:inline-block;color:rgba(0,0,0,.8);font-size:.75em;line-height:1.4;background-color:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:-.15em .15em 0 .15em;padding:.2em .6em .2em .5em;vertical-align:middle;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menu{color:rgba(0,0,0,.8)}
b.button:before,b.button:after{position:relative;top:-1px;font-weight:400}
b.button:before{content:"[";padding:0 3px 0 2px}
b.button:after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header {background: url('deck.js/themes/style/images/bg-pattern-blue.png') bottom left; color: #F8F7F6; text-align: center; min-height: 320px; padding: 30px 0;}
	#header .brand {width: 225px; height: 69px; background-size: 225px 69px; margin: 1em auto; background:url('deck.js/themes/style/images/academy-logo-white.svg') no-repeat;}
	#header>h1 {color: #F8F7F6; font-size: 3.75em;; margin-top: .5em;}
#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header:before,#header:after,#content:before,#content:after,#footnotes:before,#footnotes:after,#footer:before,#footer:after{content:" ";display:table}
#header:after,#content:after,#footnotes:after,#footer:after{clear:both}
#content{margin-top:1.25em;}
#content:before{content:none}
	#content .sect1 h2 {color: #374c51; font-weight: 300; text-align: center;}
	#content .sect1 {}
	.sect1{padding-bottom:.625em}
	@media only screen and (min-width:768px){.sect1{padding-bottom:1.25em}}
	.sect1+.sect1{}

	.sect1 h4 {color: #22836A;}
	.sect h4 strong {font-weight: bold;}
	.sectionbody  {background: white; border-radius: 3px; padding: 1.5em;}
	.sectionbody ol {list-style-position: inside; margin-left: 0;}
	.sectionbody ol li {border-bottom: 1px solid #ebeee8;}
	.sectionbody ol li:hover {background: #fafafa;}
	.sectionbody ol li p {margin-bottom: 0;}
	.sectionbody ol li a {text-decoration: none; color: #374c51; display: block; padding: 1em;}

#header>h1:first-child{color: #F8F7F6;margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #ddddd8}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #ddddd8;padding-bottom:8px}
#header .details{border-bottom:1px solid #ddddd8;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span:before{content:"\00a0\2013\00a0"}
#header .details br+span.author:before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark:before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber:after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #ddddd8;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #efefed;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media only screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background-color:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #efefed;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #efefed;left:auto;right:0}}@media only screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#footer{max-width:100%;background-color:rgba(0,0,0,.8);padding:1.25em}

#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor:before,h2>a.anchor:before,h3>a.anchor:before,#toctitle>a.anchor:before,.sidebarblock>.content>.title>a.anchor:before,h4>a.anchor:before,h5>a.anchor:before,h6>a.anchor:before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#BC5E2E;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock>caption.title{white-space:nowrap;overflow:visible;max-width:0}
.paragraph.lead>p,#preamble>.sectionbody>.paragraph:first-of-type p{color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>.paragraph:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #ddddd8;color:rgba(0,0,0,.6)}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
/*.admonitionblock {margin: 1.5em 0;}
   	.admonitionblock.note .icon-note::before, .admonitionblock .tip .icon-tip::before {content: "\ea0c"; color: #1B7387;}
    .admonitionblock.important .icon-important::before {content: "\ea07"; color: #22836A;}
    .admonitionblock.warning .icon-warning::before {content: "\f08f"; color: #BC5E2E;}
    .admonitionblock.caution .icon-caution::before {content: "\ea08"; color: #D2A854;}
    .admonitionblock .icon {font-size: 3.5em; padding: .25em; border-right: 3px solid #E3E4E3;}
    .admonitionblock .content {vertical-align: middle; padding: .25em;}
*/


.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock pre:not(.highlight),.listingblock pre[class="highlight"],.listingblock pre[class^="highlight "],.listingblock pre.CodeRay,.listingblock pre.prettyprint{background:#f7f7f8}
.sidebarblock .literalblock pre,.sidebarblock .listingblock pre:not(.highlight),.sidebarblock .listingblock pre[class="highlight"],.sidebarblock .listingblock pre[class^="highlight "],.sidebarblock .listingblock pre.CodeRay,.sidebarblock .listingblock pre.prettyprint{background:#f2f1f1}
.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{-webkit-border-radius:4px;border-radius:4px;word-wrap:break-word;padding:1em;font-size:.8125em}
.literalblock pre.nowrap,.literalblock pre[class].nowrap,.listingblock pre.nowrap,.listingblock pre[class].nowrap{overflow-x:auto;white-space:pre;word-wrap:normal}
@media only screen and (min-width:768px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:.90625em}}@media only screen and (min-width:1280px){.literalblock pre,.literalblock pre[class],.listingblock pre,.listingblock pre[class]{font-size:1em}}.literalblock.output pre{color:#f7f7f8;background-color:rgba(0,0,0,.9)}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.listingblock>.content{position:relative}
.listingblock code[data-lang]:before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:#999}
.listingblock:hover code[data-lang]:before{display:block}
.listingblock.terminal pre .command:before{content:attr(data-prompt);padding-right:.5em;color:#999}
.listingblock.terminal pre .command:not([data-prompt]):before{content:"$"}
table.pyhltable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.pyhltable td{vertical-align:top;padding-top:0;padding-bottom:0}
table.pyhltable td.code{padding-left:.75em;padding-right:0}
pre.pygments .lineno,table.pyhltable td:not(.code){color:#999;padding-left:0;padding-right:.5em;border-right:1px solid #ddddd8}
pre.pygments .lineno{display:inline-block;margin-right:.25em}
table.pyhltable .linenodiv{background:none!important;padding-right:0!important}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock blockquote p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote:before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.5em;margin-right:.5ex;text-align:right}
.quoteblock .quoteblock{margin-left:0;margin-right:0;padding:.5em 0;border-left:3px solid rgba(0,0,0,.6)}
.quoteblock .quoteblock blockquote{padding:0 0 0 .75em}
.quoteblock .quoteblock blockquote:before{display:none}
.verseblock{margin:0 1em 1.25em 1em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.05em;color:rgba(0,0,0,.6)}
.quoteblock.abstract{margin:0 0 1.25em 0;display:block}
.quoteblock.abstract blockquote,.quoteblock.abstract blockquote p{text-align:left;word-spacing:0}
.quoteblock.abstract blockquote:before,.quoteblock.abstract blockquote p:first-of-type:before{display:none}
table.tableblock{max-width:100%;border-collapse:separate}
table.tableblock td>.paragraph:last-child p>p:last-child,table.tableblock th>p:last-child,table.tableblock td>p:last-child{margin-bottom:0}
table.spread{width:100%}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all th.tableblock,table.grid-all td.tableblock{border-width:0 1px 1px 0}
table.grid-all tfoot>tr>th.tableblock,table.grid-all tfoot>tr>td.tableblock{border-width:1px 1px 0 0}
table.grid-cols th.tableblock,table.grid-cols td.tableblock{border-width:0 1px 0 0}
table.grid-all *>tr>.tableblock:last-child,table.grid-cols *>tr>.tableblock:last-child{border-right-width:0}
table.grid-rows th.tableblock,table.grid-rows td.tableblock{border-width:0 0 1px 0}
table.grid-all tbody>tr:last-child>th.tableblock,table.grid-all tbody>tr:last-child>td.tableblock,table.grid-all thead:last-child>tr>th.tableblock,table.grid-rows tbody>tr:last-child>th.tableblock,table.grid-rows tbody>tr:last-child>td.tableblock,table.grid-rows thead:last-child>tr>th.tableblock{border-bottom-width:0}
table.grid-rows tfoot>tr>th.tableblock,table.grid-rows tfoot>tr>td.tableblock{border-width:1px 0 0 0}
table.frame-all{border-width:1px}
table.frame-sides{border-width:0 1px}
table.frame-topbot{border-width:1px 0}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{display:table-cell;line-height:1.6;background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
td>div.verse{white-space:pre}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.unstyled,ol.unnumbered,ul.checklist,ul.none{list-style-type:none}
ul.unstyled,ol.unnumbered,ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1em;font-size:.85em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{width:1em;position:relative;top:1px}
ul.inline{margin:0 auto .625em auto;margin-left:-1.375em;margin-right:0;padding:0;list-style:none;overflow:hidden}
ul.inline>li{list-style:none;float:left;margin-left:1.375em;display:block}
ul.inline>li>*{display:block}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1{padding-right:.75em;font-weight:bold}
td.hdlist1,td.hdlist2{vertical-align:top}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist>table tr>td:first-of-type{padding:0 .75em;line-height:1}
.colist>table tr>td:last-of-type{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left,.imageblock[style*="float: left"]{margin:.25em .625em 1.25em 0}
.imageblock.right,.imageblock[style*="float: right"]{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none}
span.footnote,span.footnoteref{vertical-align:super;font-size:.875em}
span.footnote a,span.footnoteref a{text-decoration:none}
span.footnote a:active,span.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em 0;border-width:1px 0 0 0}
#footnotes .footnote{padding:0 .375em;line-height:1.3;font-size:.875em;margin-left:1.2em;text-indent:-1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background-color:#00fafa}
.black{color:#000}
.black-background{background-color:#000}
.blue{color:#0000bf}
.blue-background{background-color:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background-color:#fa00fa}
.gray{color:#606060}
.gray-background{background-color:#7d7d7d}
.green{color:#006000}
.green-background{background-color:#007d00}
.lime{color:#00bf00}
.lime-background{background-color:#00fa00}
.maroon{color:#600000}
.maroon-background{background-color:#7d0000}
.navy{color:#000060}
.navy-background{background-color:#00007d}
.olive{color:#606000}
.olive-background{background-color:#7d7d00}
.purple{color:#600060}
.purple-background{background-color:#7d007d}
.red{color:#bf0000}
.red-background{background-color:#fa0000}
.silver{color:#909090}
.silver-background{background-color:#bcbcbc}
.teal{color:#006060}
.teal-background{background-color:#007d7d}
.white{color:#bfbfbf}
.white-background{background-color:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background-color:#fafa00}
span.icon>.fa{cursor:default}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note:before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip:before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning:before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution:before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important:before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background-color:rgba(0,0,0,.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]:after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
h1,h2{letter-spacing:-.01em}
dt,th.tableblock,td.content{text-rendering:optimizeLegibility}
p,td.content{letter-spacing:-.01em}
p strong,td.content strong{letter-spacing:-.005em}
p,blockquote,dt,td.content{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background-color:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@media print{@page{margin:1.25cm .75cm}
*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare):after,a[href^="https:"]:not(.bare):after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]:after{content:" (" attr(title) ")"}
pre,blockquote,tr,img{page-break-inside:avoid}
thead{display:table-header-group}
img{max-width:100%!important}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #ddddd8!important;padding-bottom:0!important}
.sect1{padding-bottom:0!important}
.sect1+.sect1{border:0!important}
#header>h1:first-child{margin-top:1.25rem}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em 0}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span:before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]:before{display:block}
#footer{background:none!important;padding:0 .9375em}
#footer-text{color:rgba(0,0,0,.6)!important;font-size:.9em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}</style>
<style>/* Stylesheet for CodeRay to match GitHub theme | MIT License | http://foundation.zurb.com */
/*pre.CodeRay {background-color:#f7f7f8;}*/
.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}
.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,.3)}
.CodeRay .line-numbers strong{font-weight: normal}
table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}
table.CodeRay td{vertical-align: top}
table.CodeRay td.line-numbers{text-align:right}
table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,.3)}
table.CodeRay td.code{padding:0 0 0 .5em}
table.CodeRay td.code>pre{padding:0}
.CodeRay .debug{color:#fff !important;background:#000080 !important}
.CodeRay .annotation{color:#007}
.CodeRay .attribute-name{color:#000080}
.CodeRay .attribute-value{color:#700}
.CodeRay .binary{color:#509}
.CodeRay .comment{color:#998;font-style:italic}
.CodeRay .char{color:#04d}
.CodeRay .char .content{color:#04d}
.CodeRay .char .delimiter{color:#039}
.CodeRay .class{color:#458;font-weight:bold}
.CodeRay .complex{color:#a08}
.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}
.CodeRay .color{color:#099}
.CodeRay .class-variable{color:#369}
.CodeRay .decorator{color:#b0b}
.CodeRay .definition{color:#099}
.CodeRay .delimiter{color:#000}
.CodeRay .doc{color:#970}
.CodeRay .doctype{color:#34b}
.CodeRay .doc-string{color:#d42}
.CodeRay .escape{color:#666}
.CodeRay .entity{color:#800}
.CodeRay .error{color:#808}
.CodeRay .exception{color:inherit}
.CodeRay .filename{color:#099}
.CodeRay .function{color:#900;font-weight:bold}
.CodeRay .global-variable{color:#008080}
.CodeRay .hex{color:#058}
.CodeRay .integer,.CodeRay .float{color:#099}
.CodeRay .include{color:#555}
.CodeRay .inline{color:#00}
.CodeRay .inline .inline{background:#ccc}
.CodeRay .inline .inline .inline{background:#bbb}
.CodeRay .inline .inline-delimiter{color:#d14}
.CodeRay .inline-delimiter{color:#d14}
.CodeRay .important{color:#555;font-weight:bold}
.CodeRay .interpreted{color:#b2b}
.CodeRay .instance-variable{color:#008080}
.CodeRay .label{color:#970}
.CodeRay .local-variable{color:#963}
.CodeRay .octal{color:#40e}
.CodeRay .predefined{color:#369}
.CodeRay .preprocessor{color:#579}
.CodeRay .pseudo-class{color:#555}
.CodeRay .directive{font-weight:bold}
.CodeRay .type{font-weight:bold}
.CodeRay .predefined-type{color:inherit}
.CodeRay .reserved,.CodeRay .keyword {color:#000;font-weight:bold}
.CodeRay .key{color:#808}
.CodeRay .key .delimiter{color:#606}
.CodeRay .key .char{color:#80f}
.CodeRay .value{color:#088}
.CodeRay .regexp .delimiter{color:#808}
.CodeRay .regexp .content{color:#808}
.CodeRay .regexp .modifier{color:#808}
.CodeRay .regexp .char{color:#d14}
.CodeRay .regexp .function{color:#404;font-weight:bold}
.CodeRay .string{color:#d20}
.CodeRay .string .string .string{background:#ffd0d0}
.CodeRay .string .content{color:#d14}
.CodeRay .string .char{color:#d14}
.CodeRay .string .delimiter{color:#d14}
.CodeRay .shell{color:#d14}
.CodeRay .shell .delimiter{color:#d14}
.CodeRay .symbol{color:#990073}
.CodeRay .symbol .content{color:#a60}
.CodeRay .symbol .delimiter{color:#630}
.CodeRay .tag{color:#008080}
.CodeRay .tag-special{color:#d70}
.CodeRay .variable{color:#036}
.CodeRay .insert{background:#afa}
.CodeRay .delete{background:#faa}
.CodeRay .change{color:#aaf;background:#007}
.CodeRay .head{color:#f8f;background:#505}
.CodeRay .insert .insert{color:#080}
.CodeRay .delete .delete{color:#800}
.CodeRay .change .change{color:#66f}
.CodeRay .head .head{color:#f4f}</style>
</head>
<body class="article">
<div id="header">
<div class="brand"></div>
<h1>DS201: DataStax Enterprise Foundations of Apache Cassandra</h1>
</div>
<div id="content">
<div class="sect1">
<h2 id="EXERCISE-1">Exercise 1: Install and Start DataStax Enterprise</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>SSH into your cloud instance using the IP provided by your instructor</p>
</li>
<li>
<p>In root directory, find and install DataStax Enterprise from a tarball instance</p>
</li>
<li>
<p>Start DataStax Enterprise and verify that it is running with <code>dsetool</code></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>In order to do the remaining exercises, you must complete this one successfully. If you have any questions, alert your instructor.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>If you are taking this course in a class environment, your instructor will assign you and IP address of a cloud instance you will SSH into.</p>
</div>
<div class="paragraph">
<p><em>If you are doing these exercises on a virtual machine, just open a terminal window and skip the first step.</em> You also need to increase the memory allocated to your virtual machine. If you don&#8217;t, some of the multi-node exercises may possibly fail due to lack of memory. We recommend giving your virtual machine 8GB.</p>
</div>
<div class="paragraph">
<p>1) SSH to the cloud instance provided using the IP address provided to you by the instructor.</p>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ssh -i classkey root@&lt;student ip&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) At the <code>/root/</code> directory, list the contents and notice the presence of <code>dse-5.0.3.tar.gz</code>. For this course, we will install DataStax Enterprise by extracting it locally. Do so by running</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tar -xf dse-5.0.3.tar.gz</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) List the contents of the directory again. You now have a <code>dse-5.0.3</code> directory. Rename this directory to <code>node</code> by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>mv dse-5.0.3 node</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Normally, Cassandra places data files, log files, etc. into conventional locations within the file system. However, we will run a script to configure Cassandra to put these files under the installation folder. This configuration allows easy access during these exercises. Run the following script to do this configuration:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>labwork/config_node</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the script shows the various configuration settings that the script is changing.</p>
</div>
<div class="paragraph">
<p>5) CD into the directory with DataStax Enterprise by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd node/bin</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Start DataStax Enterprise from here by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./dse cassandra</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
DataStax Enterprise might take a few minutes to start up! Be patient. You may need to hit <code>enter</code> to get back a prompt.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>7) To check to see if DataStax Enterprise has started, run the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./dsetool status</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If it started up properly, you will see something similar to:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node/bin# ./dsetool status
DC: Cassandra       Workload: Cassandra       Graph: no
======================================================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--   Address          Load             Owns       Token                    Rack         Health [0,1]
UN   127.0.0.1        88.51 KB         ?          3230589420265814784      rack1        0.10

Note: you must specify a keyspace to get ownership information.</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Leave it up and running for the next exercise.  Congrats!  You installed and started DataStax Enterprise.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-2">Exercise 2: CQL</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-2"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Create a keyspace for KillrVideo</p>
</li>
<li>
<p>Create a table to store video metadata</p>
</li>
<li>
<p>Load the data for the video table from a CSV file</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-2"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Welcome to the KillrVideo company! KillrVideo hired you to build the latest and greatest video sharing application on the Internet. Your task is to ramp up on the domain and become acquainted with Cassandra. To start, you decided to look into creating a table schema and to load some video data.</p>
</div>
<div class="paragraph">
<p>The video metadata is made up of:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Column Name</th>
<th class="tableblock halign-left valign-top">Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timeuuid</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-2"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Back in your Terminal window, make sure DataStax Enterprise is still runing with <code>./dsetool status</code>. If not, restart DataStax Enterprise.</p>
</div>
<div class="paragraph">
<p>2) In the terminal window, start cqlsh:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/cqlsh</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) In <code>cqlsh</code>, create a keyspace called <code>killrvideo</code>. Use <code>SimpleStrategy</code> for the replication class with a replication factor of one.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You can press the tab key within the CREATE KEYSPACE command to have <code>cqlsh</code> autocomplete the replication parameters.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> KEYSPACE...</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) In <code>cqlsh</code> switch to the newly created keyspace with the <code>USE</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Create a single table called <code>videos</code> with the same structure as shown above. <code>video_id</code> is the primary key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Manually insert a single record using into the table using <code>INSERT</code> command.  Use the first row from the table below:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 33%;">
<col style="width: 33%;">
<col style="width: 33%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">video_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">added_date</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">title</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1645ea59-14bd-11e5-a993-8138354b7e31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2014-01-29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cassandra History</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">245e8024-14bd-11e5-9743-8238356b7e32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2012-04-03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cassandra &amp; SSDs</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3452f7de-14bd-11e5-855e-8738355b7e3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013-03-17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cassandra Intro</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4845ed97-14bd-11e5-8a40-8338255b7e33</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013-10-16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">DataStax DevCenter</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5645f8bd-14bd-11e5-af1a-8638355b8e3a</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2013-04-16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">What is DataStax Enterprise?</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">INSERT</span> <span class="class">INTO</span> videos (video_id, added_date, title)
<span class="keyword">VALUES</span> (<span class="error">1</span><span class="error">6</span><span class="error">4</span><span class="error">5</span>ea59<span class="integer">-14</span>bd<span class="float">-11e5</span>-a993<span class="integer">-8138354</span>b7e31, <span class="string"><span class="delimiter">'</span><span class="content">2014-01-29</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Cassandra History</span><span class="delimiter">'</span></span>);</code></pre>
</div>
</div>
<div class="paragraph">
<p>7) Write a select statement to verify your record was inserted.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>...</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Insert the second record as well and run a select statement to verify it&#8217;s there.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">INSERT</span> <span class="class">INTO</span> videos...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
You should now see two records in your videos table.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>9) Let&#8217;s remove the data you inserted using the <code>TRUNCATE</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">TRUNCATE</span> videos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) Execute the following command to import data into your videos table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos(video_id, added_date, title)
<span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">/root/labwork/data-files/videos.csv</span><span class="delimiter">'</span></span>
WITH HEADER=<span class="predefined-constant">TRUE</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Use SELECT to verify the data loaded correctly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> *
<span class="keyword">FROM</span> videos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Use SELECT to <code>COUNT(*)</code> the number of imported rows. It should match the number of rows COPY reported as imported.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> <span class="predefined">COUNT</span>(*)
<span class="keyword">FROM</span> videos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>13) To leave CQLSH execute this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>QUIT</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-3">Exercise 3: Partitions</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Be sure Cassandra is running before doing these exercises. You can check by running nodetool on the command line:
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">/root/node/<span class="predefined-type">bin</span>/dsetool status</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-3"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Start the CQL command shell at the command line:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">/root/node/resources/cassandra/<span class="predefined-type">bin</span>/cqlsh</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Switch to the killrvideo keyspace via the USE command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Execute the following command to view the metadata for the <code>videos</code> table you created earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">DESCRIBE <span class="type">TABLE</span> videos;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>What is the partition key?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><code>video_id</code></p>
</div>
<div class="ulist">
<ul>
<li>
<p>How many partitions are in this table?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>One for each unique primary key value.</p>
</div>
<div class="paragraph">
<p>4) Execute the following query to view the partitioner token value for each video id.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> token(video_id), video_id
<span class="keyword">FROM</span> videos;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Exit <code>cqlsh</code> and use the following command to inspect the file named <code>/root/labwork/data-files/videos-by-tag.csv</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">cat /root/labwork/data-files/videos-<span class="keyword">by</span>-tag.csv</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice this CSV file categorizes the videos by one of two tags: <code>cassandra</code> or <code>datastax</code>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>6) Restart <code>cqlsh</code> and switch to the <code>killrvideo</code> keyspace.</p>
</div>
<div class="paragraph">
<p>7) Your mission, should you choose to accept it, is to write a <code>CREATE TABLE</code> statement that will store this data partitioned by tags. With this given data set, there should be two partitions, one for each tag. Call your table <code>videos_by_tag</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span>...</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Execute the following COPY command to import the videos-by-tag.csv data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos_by_tag(tag, video_id, added_date, title)
<span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">/root/labwork/data-files/videos-by-tag.csv</span><span class="delimiter">'</span></span>
WITH HEADER = <span class="predefined-constant">TRUE</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>9) Verify CQL imported your data correctly by writing a <code>SELECT *</code> command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>...</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>Note that if the table only contains 2 records, the primary key may be wrong - containing only the tag field - be sure to include the <code>video_id</code> as a cluster column.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>10) Write a SELECT statement to retrieve all rows tagged with <code>cassandra</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> *
<span class="keyword">FROM</span> videos_by_tag
<span class="keyword">WHERE</span> tag = <span class="string"><span class="delimiter">'</span><span class="content">cassandra</span><span class="delimiter">'</span></span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Now, find all videos tagged with <code>datastax</code> (similar to the previous query).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>...</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Finally, write a query to retrieve the video having a title of <code>Cassandra Intro</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> *
<span class="keyword">FROM</span> videos_by_tag
<span class="keyword">WHERE</span> title = <span class="string"><span class="delimiter">'</span><span class="content">Cassandra Intro</span><span class="delimiter">'</span></span>;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice your query errors out. Cassandra only allows queries on the partition key (and clustering columns shown in the next section). Since <code>title</code> is not the partition key, Cassandra fails the query. If Cassandra allowed querying on non-partition key columns, Cassandra would have to scan all partitions on all nodes to produce a result set (which goes against the reason you would use Cassandra in the first place).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-4">Exercise 4: Clustering Columns</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-3"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand how clustering columns affect the underlying storage mechanism.</p>
</li>
<li>
<p>Understand how clustering columns affect queries.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-3"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Clustering columns are those columns that are part of the primary key, but are not the partition key.
This exercise will help you understand how clustering columns affect what and how you can query.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-4"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Ensure you are using the killrvideo keyspace by executing the line below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Drop your <code>videos_by_tag</code> table that you created in the previous exercise.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DROP TABLE videos_by_tag;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Modify the following command to create a new <code>videos_by_tag</code> table partitioned based on the tag. The table should also store the rows of each partition so that the newest videos are listed first within the partition.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Remember that you must include WITH CLUSTERING ORDER BY(column1 ASC/DESC, column2 ASC/DESC, etc.) to do so.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">CREATE</span> <span class="type">TABLE</span> videos_by_tag (
  tag <span class="predefined-type">TEXT</span>,
  video_id UUID,
  added_date <span class="predefined-type">TIMESTAMP</span>,
  title <span class="predefined-type">TEXT</span>,
  <span class="directive">PRIMARY</span> <span class="type">KEY</span> ((tag), video_id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Import the videos_by_tag.csv again via the COPY command by executing the code below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql">COPY videos_by_tag(tag, video_id, added_date, title)
<span class="keyword">FROM</span> <span class="string"><span class="delimiter">'</span><span class="content">/root/labwork/data-files/videos-by-tag.csv</span><span class="delimiter">'</span></span>
WITH HEADER = <span class="predefined-constant">TRUE</span>;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Perform a SELECT * query on <code>videos_by_tag</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> *
<span class="keyword">FROM</span> videos_by_tag;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Notice the rows are still grouped by their partition key value but ordered in descending order of added date.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>6) Execute your query again, but list the oldest videos first.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span> *
<span class="keyword">FROM</span> videos_by_tag
<span class="keyword">ORDER</span> <span class="keyword">BY</span> added_date <span class="directive">DESC</span>;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Your query will fail. When specifying ORDER BY, you must also restrict the partition key.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>7) Change your query to restrict the partition key value to <code>cassandra</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>...</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Clustering columns allow range queries (&lt;, &#8656;, &gt;=).
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>8) Change your query to retrieve videos made in 2013 or later.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="sql"><span class="class">SELECT</span>...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-5">Exercise 5: Drivers</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-4"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>You will understand what Cassandra drivers are and their purpose.</p>
</li>
<li>
<p>You will be able to create and read records using a driver.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-4"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>As we have already seen, we can access Cassandra for client applications such as CQLSH. However, we may want to access Cassandra directly from within an application we create. Drivers are the mechanisms we use to interact with Cassandra from a programming language.
In this exercise, we will connect to our Cassandra database using the Python driver and read and write some data.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-5"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Back in your Terminal window, make sure DataStax Enterprise is still runing with <code>/root/node/bin/dsetool status</code>. If not, restart DataStax Enterprise.</p>
</div>
<div class="paragraph">
<p>2) Start your Python interpreter:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# python
Python 2.7.6 (default, Mar 22 2014, 22:59:56)
[GCC 4.8.2] on linux2
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Let&#8217;s write Python code to connect to the cluster and open a session:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>from cassandra.cluster import Cluster
cluster = Cluster(protocol_version = 3)
session = cluster.connect('killrvideo')</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If you have trouble connecting, your python driver may be out of date. Use <code>sudo pip install --upgrade cassandra-driver</code> to update the driver.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4) Now write code to retrieve all records in the <code>videos_by_tag</code> table. Display your results using Python&#8217;s <code>print()</code> function:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>for val in session.execute(...</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) <code>session.execute()</code> returns a sequence of rows (tuples), which you can further index into to get cell values. Try executing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>print('{0:12} {1:40} {2:5}'.format('Tag', 'ID', 'Title'))
for val in session.execute("select * from videos_by_tag"):
    print('{0:12} {1:40} {2:5}'.format(val[0], val[2], val[3]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>We use some simple string formatting to make the output bearable. Notice we index into each tuple using the bracket operator.</p>
</div>
<div class="paragraph">
<p>6) Write some Python code to insert a new video into the database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>session.execute(
    "INSERT INTO videos_by_tag...</code></pre>
</div>
</div>
<div class="paragraph">
<p>7) Now run the following code to view your new record:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>print('{0:12} {1:40} {2:5}'.format('Tag', 'ID', 'Title'))
for val in session.execute("select * from videos_by_tag"):
    print('{0:12} {1:40} {2:5}'.format(val[0], val[2], val[3]))</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Now write Python code to delete your record:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>session.execute("DELETE FROM videos_by_tag...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note to instructor - be sure to use the correct UUID for video_id.</p>
</div>
<div class="paragraph">
<p>9) Now execute the following code to confirm that your record is gone:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>print('{0:12} {1:40} {2:5}'.format('Tag', 'ID', 'Title'))
for val in session.execute("select * from videos_by_tag"):
    print('{0:12} {1:40} {2:5}'.format(val[0], val[2], val[3]))</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-6">Exercise 6: Node</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-5"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand what Cassandra nodes are.</p>
</li>
<li>
<p>Understand core hardware/software requirements of a node.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-5"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Nodes are the building blocks of Cassandra&#8217;s clusters.
Therefore, it is useful to understand the care and feeding of nodes.
These exercises will do just that.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-6"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Open a terminal and navigate to your <code>/root/node/resources/cassandra/bin/</code> folder.</p>
</div>
<div class="paragraph">
<p>2) Execute <code>nodetool</code> with the <code>help</code> command to list all possible commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool help</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node/resources/cassandra/bin# ./nodetool help
usage: nodetool [(-pwf &lt;passwordFilePath&gt; | --password-file &lt;passwordFilePath&gt;)]
        [(-h &lt;host&gt; | --host &lt;host&gt;)] [(-u &lt;username&gt; | --username &lt;username&gt;)]
        [(-pw &lt;password&gt; | --password &lt;password&gt;)] [(-p &lt;port&gt; | --port &lt;port&gt;)]
        &lt;command&gt; [&lt;args&gt;]

The most commonly used nodetool commands are:
    assassinate                  Forcefully remove a dead node without re-replicating any data.  Use as a last resort if you cannot removenode
    bootstrap                    Monitor/manage node's bootstrap process
    cleanup                      Triggers the immediate cleanup of keys no longer belonging to a node. By default, clean all keyspaces
    clearsnapshot                Remove the snapshot with the given name from the given keyspaces. If no snapshotName is specified we will remove all snapshots
    compact                      Force a (major) compaction on one or more tables
    compactionhistory            Print history of compaction
    compactionstats              Print statistics on compactions
    decommission                 Decommission the *node I am connecting to*
    describecluster              Print the name, snitch, partitioner and schema version of a cluster
    describering                 Shows the token ranges info of a given keyspace
    disableautocompaction        Disable autocompaction for the given keyspace and table
    disablebackup                Disable incremental backup
    disablebinary                Disable native transport (binary protocol)
    disablegossip                Disable gossip (effectively marking the node down)
    disablehandoff               Disable storing hinted handoffs
    disablehintsfordc            Disable hints for a data center
    disablethrift                Disable thrift server
    drain                        Drain the node (stop accepting writes and flush all tables)
    enableautocompaction         Enable autocompaction for the given keyspace and table
    enablebackup                 Enable incremental backup
    enablebinary                 Reenable native transport (binary protocol)
    enablegossip                 Reenable gossip
    enablehandoff                Reenable future hints storing on the current node
    enablehintsfordc             Enable hints for a data center that was previsouly disabled
    enablethrift                 Reenable thrift server
    failuredetector              Shows the failure detector information for the cluster
    flush                        Flush one or more tables
    gcstats                      Print GC Statistics
    getcompactionthreshold       Print min and max compaction thresholds for a given table
    getcompactionthroughput      Print the MB/s throughput cap for compaction in the system
    getendpoints                 Print the end points that owns the key
    getinterdcstreamthroughput   Print the Mb/s throughput cap for inter-datacenter streaming in the system
    getlogginglevels             Get the runtime logging levels
    getsstables                  Print the sstable filenames that own the key
    getstreamthroughput          Print the Mb/s throughput cap for streaming in the system
    gettraceprobability          Print the current trace probability value
    gossipinfo                   Shows the gossip information for the cluster
    help                         Display help information
    info                         Print node information (uptime, load, ...)
    invalidatecountercache       Invalidate the counter cache
    invalidatekeycache           Invalidate the key cache
    invalidaterowcache           Invalidate the row cache
    join                         Join the ring
    listsnapshots                Lists all the snapshots along with the size on disk and true size.
    move                         Move node on the token ring to a new token
    netstats                     Print network information on provided host (connecting node by default)
    pausehandoff                 Pause hints delivery process
    proxyhistograms              Print statistic histograms for network operations
    rangekeysample               Shows the sampled keys held across all keyspaces
    rebuild                      Rebuild data by streaming from other nodes (similarly to bootstrap)
    rebuild_index                A full rebuild of native secondary indexes for a given table
    refresh                      Load newly placed SSTables to the system without restart
    refreshsizeestimates         Refresh system.size_estimates
    reloadtriggers               Reload trigger classes
    removenode                   Show status of current node removal, force completion of pending removal or remove provided ID
    repair                       Repair one or more tables
    replaybatchlog               Kick off batchlog replay and wait for finish
    resetlocalschema             Reset node's local schema and resync
    resumehandoff                Resume hints delivery process
    ring                         Print information about the token ring
    scrub                        Scrub (rebuild sstables for) one or more tables
    setcachecapacity             Set global key, row, and counter cache capacities (in MB units)
    setcachekeystosave           Set number of keys saved by each cache for faster post-restart warmup. 0 to disable
    setcompactionthreshold       Set min and max compaction thresholds for a given table
    setcompactionthroughput      Set the MB/s throughput cap for compaction in the system, or 0 to disable throttling
    sethintedhandoffthrottlekb   Set hinted handoff throttle in kb per second, per delivery thread.
    setinterdcstreamthroughput   Set the Mb/s throughput cap for inter-datacenter streaming in the system, or 0 to disable throttling
    setlogginglevel              Set the log level threshold for a given class. If both class and level are empty/null, it will reset to the initial configuration
    setstreamthroughput          Set the Mb/s throughput cap for streaming in the system, or 0 to disable throttling
    settraceprobability          Sets the probability for tracing any given request to value. 0 disables, 1 enables for all requests, 0 is the default
    snapshot                     Take a snapshot of specified keyspaces or a snapshot of the specified table
    status                       Print cluster information (state, load, IDs, ...)
    statusbackup                 Status of incremental backup
    statusbinary                 Status of native transport (binary protocol)
    statusgossip                 Status of gossip
    statushandoff                Status of storing future hints on the current node
    statusthrift                 Status of thrift server
    stop                         Stop compaction
    stopdaemon                   Stop cassandra daemon
    tablehistograms              Print statistic histograms for a given table
    tablestats                   Print statistics on tables
    toppartitions                Sample and print the most active partitions for a given column family
    tpstats                      Print usage statistics of thread pools
    truncatehints                Truncate all hints on the local node, or truncate hints for the endpoint(s) specified.
    upgradesstables              Rewrite sstables (for the requested tables) that are not on the current version (thus upgrading them to said current version)
    verify                       Verify (check data checksum for) one or more tables
    version                      Print cassandra version

See 'nodetool help &lt;command&gt;' for more information on a specific command.</code></pre>
</div>
</div>
<div class="paragraph">
<p>Some commands display information about the entire cluster. Some commands show information only about the node that nodetool has connected to. Others commands are operations that can be run specifically on the connected node.</p>
</div>
<div class="paragraph">
<p>3) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool status</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="nodetool status" src="images/cassandra/internals/node-architecture/node/nodetool-status.png">
</div>
</div>
<div class="paragraph">
<p>The status command shows information about the entire cluster, particularly the state of each node, and information about each of those nodes: IP address, data load, number of tokens, total percentage of data saved on each node, host ID, and datacenter and rack. We will discuss these in detail as the course progresses.</p>
</div>
<div class="paragraph">
<p>4) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dsetool status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Take note as to the differences between <code>dsetool status</code> and <code>nodetool status</code>. Although both tools have a <code>status</code> command, <code>dsetool</code> works with DataStax Enterprise&#8482; as a whole (Cassandra, Spark, Solr, Graph) whereas <code>nodetool</code> is specific to Apache Cassandra&#8482;. Their functionality diverges from here.</p>
</div>
<div class="paragraph">
<p>5) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool info</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node/resources/cassandra/bin# ./nodetool info
ID                     : 5d2c73b4-a49c-488b-959e-6f8118016f1c
Gossip active          : true
Thrift active          : true
Native Transport active: true
Load                   : 158.26 KB
Generation No          : 1477608393
Uptime (seconds)       : 6121
Heap Memory (MB)       : 548.00 / 1024.00
Off Heap Memory (MB)   : 0.00
Data Center            : Cassandra
Rack                   : rack1
Exceptions             : 0
Key Cache              : entries 32, size 2.48 KB, capacity 51 MB, 223 hits, 272 requests, 0.820 recent hit rate, 14400 save period in seconds
Row Cache              : entries 0, size 0 bytes, capacity 0 bytes, 0 hits, 0 requests, NaN recent hit rate, 0 save period in seconds
Counter Cache          : entries 0, size 0 bytes, capacity 25 MB, 0 hits, 0 requests, NaN recent hit rate, 7200 save period in seconds
Token                  : 3230589420265814784</code></pre>
</div>
</div>
<div class="paragraph">
<p>The info command displays information about the connected node, which includes token information, host ID, protocol status, data load, node uptime, heap memory usage and capacity, datacenter and rack information, number of errors reported, and cache usage. Again, we will cover most of these later.</p>
</div>
<div class="paragraph">
<p>6) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool describecluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node/resources/cassandra/bin# ./nodetool describecluster
Cluster Information:
	Name: Test Cluster
	Snitch: org.apache.cassandra.locator.DynamicEndpointSnitch
	Partitioner: org.apache.cassandra.dht.Murmur3Partitioner
	Schema versions:
		a9b8059e-f66e-3c04-a947-df8a5d933d49: [127.0.0.1]</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>describecluster</code> shows the settings that are common across all of the nodes in the cluster and the current schema version used by each node. We have a simple one node cluster currently but will add to it soon.</p>
</div>
<div class="paragraph">
<p>7) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool getlogginglevels</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node/resources/cassandra/bin# ./nodetool getlogginglevels

Logger Name                                        Log Level
ROOT                                                    INFO
DroppedAuditEventLogger                                 INFO
SLF4JAuditWriter                                        INFO
SolrValidationErrorLogger                              ERROR
com.cryptsoft                                            OFF
com.datastax.bdp.search.solr.metrics.MetricsWriteEventListener     DEBUG
com.thinkaurelius.thrift                               ERROR
org.apache.cassandra                                   DEBUG
org.apache.lucene.index                                 INFO
org.apache.solr.core.CassandraSolrConfig                WARN
org.apache.solr.core.RequestHandlers                    WARN
org.apache.solr.core.SolrCore                           WARN
org.apache.solr.handler.component                       WARN
org.apache.solr.search.SolrIndexSearcher                WARN
org.apache.solr.update                                  WARN</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Also try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool setlogginglevel org.apache.cassandra TRACE</code></pre>
</div>
</div>
<div class="paragraph">
<p>The command <code>setlogginglevel</code> dynamically changes the logging level used by Cassandra without the need for a restart. You can also take a look at the <code>/var/log/cassandra/system.log</code> afterwards to observe the changes.</p>
</div>
<div class="paragraph">
<p>9) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool settraceprobability 0.1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The resultant value from the <code>settraceprobability</code> command represents a decimal describing the percentage of queries being saved, starting from 0 (0%) to 1 (100%). Saved traces can then be viewed in the <code>system_traces</code> keyspace.</p>
</div>
<div class="paragraph">
<p>10) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool drain</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>drain</code> command stops writes from occurring on the node and flushes all data to disk. Typically, this command may be run before stopping a Cassandra node.</p>
</div>
<div class="paragraph">
<p>11) Try:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool stopdaemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>stopdaemon</code> command stops a node&#8217;s execution. Wait for it to complete.</p>
</div>
<div class="paragraph">
<p>You can also stop the node by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra-stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Restart your node by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for Cassandra to start before continuing.</p>
</div>
<div class="paragraph">
<p>13) We will now stress the node using a simple tool called Cassandra Stress. Once your node has restarted, navigate to the <code>/root/node/resources/cassandra/tools/bin</code> directory in the terminal. Run <code>cassandra-stress</code> to populate the cluster with 50,000 partitions using 1 client thread and without any warmup using:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./cassandra-stress write n=50000 no-warmup -rate threads=1</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="cassandra stress" src="images/cassandra/internals/node-architecture/node/cassandra-stress.png">
</div>
</div>
<div class="paragraph">
<p>As Cassandra stress executes, it logs several statistics to the terminal. Each line displays the statistics for the operations that occurred each second and shows number of partitions written, operations per second, latency information, and more.</p>
</div>
<div class="paragraph">
<p>14) Navigate back to <code>/root/node/resources/cassandra/bin</code> and run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool flush</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>flush</code> command commits all written (memtable, discussed later) data to disk. Unlike <code>drain</code>, <code>flush</code> allows further writes to occur.</p>
</div>
<div class="paragraph">
<p>15) Check the new load on the node. Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>./nodetool status</code></pre>
</div>
</div>
<div class="imageblock">
<div class="content">
<img alt="nodetool status more load" src="images/cassandra/internals/node-architecture/node/nodetool-status-more-load.png">
</div>
</div>
<div class="paragraph">
<p>16) We will now examine the data <code>cassandra-stress</code> wrote to our node. Start <code>./cqlsh</code>. Execute the following CQLSH command to view the current keyspaces:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DESCRIBE KEYSPACES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the presence of <code>keyspace1</code> which <code>cassandra-stress</code> created.</p>
</div>
<div class="paragraph">
<p>17) Switch to that keyspace by executing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>USE keyspace1;</code></pre>
</div>
</div>
<div class="paragraph">
<p>18) View the tables in <code>keyspace1</code> by executing the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DESCRIBE TABLES;</code></pre>
</div>
</div>
<div class="paragraph">
<p>19) Query the first five rows from <code>standard1</code> by executing the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM standard1
LIMIT 5;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The data that was written is not very meaningful, since they are all arbitrary BLOB values.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-7">Exercise 7: Ring</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-6"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand the Cassandra token ring</p>
</li>
<li>
<p>Create a two-node cluster</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-6"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>One of the secrets to Apache Cassandra&#8217;s&#8482; performance is the use of a ring that keeps track of tokens. This ring enables Apache Cassandra&#8482; to know exactly which nodes contain which partitions. The ring also eliminates any single points of failure.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-7"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) First, we will shut down your current node. Do so by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra-stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>Wait for the node to terminate before continuing.</p>
</div>
<div class="paragraph">
<p>2) Delete the <code>/root/node/</code> folder by executing the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cd /root/
rm -rf node/</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) To make a two node cluster, we will unzip the DataStax Enterprise&#8482; tarball twice making two folders: node1 and node2. In your terminal, execute the following commands within the <code>/root/</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tar -xf dse-5.0.3.tar.gz
mv dse-5.0.3 node1
labwork/config_node 1
tar -xf dse-5.0.3.tar.gz
mv dse-5.0.3 node2
labwork/config_node 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Open the <code>/root/node2/resources/cassandra/conf/cassandra.yaml</code> file in <code>vi</code>, <code>nano</code> or any other text editor.</p>
</div>
<div class="paragraph">
<p>5) Change the <code>initial_token</code> value and set it to 9223372036854775807 (note you need a space between the colon and the value). This node will manage the second half of the token range&#8212;&#8203;the positive tokens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># initial_token allows you to specify tokens manually.  While you can use # it with
# vnodes (num_tokens &gt; 1, above) -- in which case you should provide a
# comma-separated list -- it's primarily used when adding nodes # to legacy clusters
# that do not have vnodes enabled.
initial_token: 9223372036854775807</code></pre>
</div>
</div>
<div class="paragraph">
<p>Save the changes to the file and exit the text editor.</p>
</div>
<div class="paragraph">
<p>6) In your terminal, start the first node via <code>/root/node1/bin/dse cassandra</code></p>
</div>
<div class="paragraph">
<p>Wait for the node to start up. Once it has done so, press enter to get back to the prompt.</p>
</div>
<div class="paragraph">
<p>7) Run the <code>/root/node1/resources/cassandra/bin/nodetool status</code> command to verify the node is working properly.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node1/resources/cassandra/bin/nodetool status
Datacenter: Cassandra
=====================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Owns    Host ID                               Token      Rack
UN  127.0.0.1  88.55 KB   ?       ddaedc8b-0ed4-4567-b986-db32105fc096  0          rack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>UN</code> indicates UP NORMAL meaning the node is ready to go. Load indicates current disk space usage. Owns indicates how many tokens this node is responsible for (it is the only node in the ring at the moment). Token should be 0 (the same value we set in the cassandra.yaml file). However, this is not a reliable value. We discuss racks later in the course.</p>
</div>
<div class="paragraph">
<p>8) Start the second node via <code>/root/node2/bin/dse cassandra</code> command. This node will take longer to bootstrap and join the cluster.</p>
</div>
<div class="paragraph">
<p>Wait for the second node to finish bootstrapping before continuing.</p>
</div>
<div class="paragraph">
<p>9) Use <code>/root/node1/resources/cassandra/bin/nodetool status</code> again to view the current state of the cluster.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node1/resources/cassandra/bin/nodetool status
Datacenter: Cassandra
=====================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Tokens       Owns    Host ID                               Rack
UN  127.0.0.1  93.52 KB   1            ?       ddaedc8b-0ed4-4567-b986-db32105fc096  rack1
UN  127.0.0.2  102.01 KB  1            ?       46e8a752-afb4-433f-8465-6ac1a3bb3137  rack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice both nodes are now up and normal. If not, please consult your instructor.</p>
</div>
<div class="paragraph">
<p>10) Now let&#8217;s recreate the two tables we made in previous exercises and import their data. Start <code>cqlsh</code> and execute the commands that follow:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CREATE KEYSPACE killrvideo
WITH replication = {'class': 'SimpleStrategy', 'replication_factor': 1 };

USE killrvideo;

CREATE TABLE videos (
    id uuid,
    added_date timestamp,
    title text,
    PRIMARY KEY ((id))
);

COPY videos(id, added_date, title)
FROM '/root/labwork/data-files/videos.csv'
WITH HEADER=TRUE;

CREATE TABLE videos_by_tag (
    tag text,
    video_id uuid,
    added_date timestamp,
    title text,
    PRIMARY KEY ((tag), added_date, video_id))
    WITH CLUSTERING ORDER BY(added_date DESC);

COPY videos_by_tag(tag, video_id, added_date, title)
FROM '/root/labwork/data-files/videos-by-tag.csv'
WITH HEADER=TRUE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Now let&#8217;s determine which nodes own which partitions in the <code>videos_by_tag table</code>. Execute the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT token(tag), tag
FROM videos_by_tag;</code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>How many partitions are there?</p>
</li>
<li>
<p>On which node does each partition reside?</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>12) You can refresh your memory as to which nodes own which token ranges by running the following in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool ring</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node1/resources/cassandra/bin/nodetool ring

Datacenter: Cassandra
==========
Address    Rack        Status State   Load       Owns      Token
                                                           9223372036854775807
127.0.0.1  rack1       Up     Normal  82.21 KB   ?         0
127.0.0.2  rack1       Up     Normal  86.92 KB   ?         9223372036854775807</code></pre>
</div>
</div>
<div class="paragraph">
<p>13) You can further prove which partition resides on which node by executing the following nodetool commands in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'
/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'datastax'</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>getendpoints</code> returns the IP addresses of the node(s) which store the partitions with the respective partition key value (the last argument in single quotes: <code>cassandra</code> and <code>datastax</code> respectively). Notice we must also supply the keyspace and table name we are interested in since we set replication on a per-keyspace basis. There is more on replication to come later in this course.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'
127.0.0.2
root@node0:~# /root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'datastax'
127.0.0.1
root@node0:~#</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-8">Exercise 8: VNodes</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-7"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand how VNodes support partition distribution.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-7"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>The ring of tokens and nodes make Cassandra scalable and fault-tolerant, but managing partitions on solely physical nodes causes problems. For example, when a physical node goes down, it is necessary to redistribute partitions. This is where virtual nodes (or VNodes) come in. VNodes help even-out the load when redistributing partitions across physical nodes.</p>
</div>
<div class="paragraph">
<p>In this exercise, we are going to change from using single token nodes to using vnodes. Cassandra doesn&#8217;t allow changing the <code>num_tokens</code> settings after a node has joined the cluster, so we have to work around this a bit to make it work.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-8"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Be sure neither of your nodes is running. Use the <code>dsetool status</code> or <code>nodetool stopdaemon</code> command to check their running status. If either is running, be sure to stop them using the <code>dse cassandra-stop</code> command as we did earlier.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool stopdaemon
/root/node2/resources/cassandra/bin/nodetool stopdaemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Let&#8217;s investigate the <code>/root/node1/data/</code> directory. This is where we configured DataStax Enterprise&#8482; to store all your data.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~/node1/data# ls /root/node1/data/
commit-log  data  hints  saved-caches</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Deleting the data directory resets the node back to the initial state as it was before we originally started it. However, we will retain our configuration settings since these setting are stored elsewhere.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Delete the <code>data/</code> directories and everything under them for BOTH nodes using the following commands.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>rm -rf /root/node1/data/
rm -rf /root/node2/data/</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Edit <code>cassandra.yaml</code>. Change <code>num_tokens</code> to 128 and comment out <code>initial_token</code>. Do this for both node1 and node2.</p>
</div>
<div class="paragraph">
<p>4) Restart <code>/root/node1/bin/dse cassandra</code>. Once it&#8217;s up and running, start your second node as well.</p>
</div>
<div class="paragraph">
<p>Notice both nodes logged the auto-generated token values that they are responsible for.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INFO  16:35:21,549  StorageService.java:916 - Generated random tokens. tokens are [-7164459026390735414, -7329258703084495883, -2825494408418277276, -2814177963162293746, 4771436847287064946, 1221128837596336418, 2758854327629106268, 1359184591393302476, -3244875630830152156, 2742024673126635751, 6296102123997854860, -6301150735481409246, -9196071188103611550, 4633406013517800586, 6895137558562257969, 4590245658539980984, -2151196701967273224, 8649268482855384926, 4804267925799144120, -241477754725227088, -4253790134909486319, 5362349254855476300, 2189620579532464368, 1136295162244858393, 6612467125430431234, 1546161538515780728, -2137266451544176803, -3562152163008341724, 6722345001889556846, 966240072964636846, -5199600096620143233, -4119027106741372111, 9045685766372688777, 7566217708112044184, 1115723111921237189, 9070980034781260632, ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice each node now has 128 tokens.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Datacenter: Cassandra
=====================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--  Address    Load       Tokens Owns Host ID                               Rack
UN  127.0.0.1  95.94 KB   128    ?    843de4d9-048a-4df5-bc22-904525982137  rack1
UN  127.0.0.2  106.91 KB  128    ?    5dcc8e10-a33f-4624-85a4-04d12cf29060  rack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Now execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool ring</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that each node is responsible for several smaller sections of the ring.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Datacenter: Cassandra
==========
Address    Rack  Status State   Load       Owns Token
                                                9166228171654309027
127.0.0.1  rack1 Up     Normal  95.94 KB   ?    -9196071188103611550
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8969730683787016919
127.0.0.1  rack1 Up     Normal  95.94 KB   ?    -8945729420454609414
127.0.0.1  rack1 Up     Normal  95.94 KB   ?    -8719680550307100947
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8703763752322315189
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8637221419995659516
127.0.0.1  rack1 Up     Normal  95.94 KB   ?    -8591318478812904452
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8480637939866031070
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8458781044005218195
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8315930667399962439
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8296019866353816923
127.0.0.1  rack1 Up     Normal  95.94 KB   ?    -8265528382825169538
127.0.0.2  rack1 Up     Normal  106.91 KB  ?    -8242055094066959822
...</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-9">Exercise 9: Gossip</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-8"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand how Cassandra uses gossip.</p>
</li>
<li>
<p>Understand how gossip information propagates through a cluster.</p>
</li>
<li>
<p>Understand how a gossip exchange works.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-8"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>In a fully distributed system such as Cassandra, there is no single repository thats contains the state of all the nodes in the cluster. Clearly, such a repository would be a single point of failure. Instead, Cassandra uses the Gossip protocol to distribute nodes' status amongst its peers.</p>
</div>
<div class="paragraph">
<p>In this exercise, we will examine the gossip information for our two node cluster.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-9"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Be sure both nodes are up and running using <code>dsetool status</code>. Start your nodes if necessary.</p>
</div>
<div class="paragraph">
<p>2) Execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool gossipinfo</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the gossip information for both nodes as discussed in the slides.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/127.0.0.1
  generation:1477672521
  heartbeat:3882
  STATUS:28:NORMAL,-1050659531778706169
  LOAD:3727:98245.0
  SCHEMA:126:d0bd0be7-0e12-3a8d-a15e-d853e6cb6980
  DC:42:Cassandra
  RACK:12:rack1
  RELEASE_VERSION:4:3.0.9.1346
  RPC_ADDRESS:3:127.0.0.1
  X_11_PADDING:3807:{"dse_version":"5.0.3","workload":"Cassandra","server_id":"02-2C-EA-37-CE-A7","graph":false,"active":"true","health":0.2}
  SEVERITY:3881:0.0
  NET_VERSION:1:10
  HOST_ID:2:843de4d9-048a-4df5-bc22-904525982137
  RPC_READY:129:true
  TOKENS:27:&lt;hidden&gt;
/127.0.0.2
  generation:1477672660
  heartbeat:3445
  STATUS:141:NORMAL,-1042104154634378202
  LOAD:3349:109478.0
  SCHEMA:34:d0bd0be7-0e12-3a8d-a15e-d853e6cb6980
  DC:167:Cassandra
  RACK:12:rack1
  RELEASE_VERSION:4:3.0.9.1346
  RPC_ADDRESS:3:127.0.0.2
  X_11_PADDING:3310:{"dse_version":"5.0.3","workload":"Cassandra","server_id":"02-2C-EA-37-CE-A7","graph":false,"active":"true","health":0.2}
  SEVERITY:3444:0.0
  NET_VERSION:1:10
  HOST_ID:2:5dcc8e10-a33f-4624-85a4-04d12cf29060
  RPC_READY:181:true
  TOKENS:140:&lt;hidden&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that even though we executed this command on node1, node1 still knows node2&#8217;s gossip state. Also notice the node state consists of key-values pairs as discussed in the slides.</p>
</div>
<div class="paragraph">
<p>3) Rerun your <code>nodetool gossipinfo</code> command a few times and notice the heartbeat values increasing for both nodes.</p>
</div>
<div class="paragraph">
<p>4) Run <code>nodetool gossipinfo</code> on node2 instead of node1. Notice the gossip data is the same.</p>
</div>
<div class="paragraph">
<p>5) Terminate your second node by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node2/resources/cassandra/bin/nodetool stopdaemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Check the <code>gossipinfo</code> on node1. Notice node2&#8217;s gossip information is still present as it is part of the cluster, but its <code>STATUS</code> state is <code>shutdown</code>.</p>
</div>
<div class="paragraph">
<p>7) Restart your second node.</p>
</div>
<div class="paragraph">
<p>8) Rerun <code>nodetool gossipinfo</code> on either node, and notice the generation values are the same as before for node1, but are now different for node2 since we restarted node2.</p>
</div>
<div class="paragraph">
<p>9) Start <code>cqlsh</code> and execute the following query of the system.peers table which stores some gossip data about a node&#8217;s peers.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT peer, data_center, host_id, preferred_ip, rack, release_version, rpc_address, schema_version
FROM system.peers;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the values here are some of the same values you saw in the terminal. Also notice that a node does not store a row of peer data for itself. By default, <code>cqlsh</code> connects to 127.0.0.1. You can change this by running:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cqlsh 127.0.0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Selecting from <code>system.peers</code> on 127.0.0.2 show&#8217;s node1&#8217;s information instead.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-10">Exercise 10: Snitches</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-9"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand how to make Cassandra aware of the cluster topology using Snitches.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-9"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>To improve fault-tolerance, distributed systems need to take the topology of the cluster into account. Cassandra uses this topological information to replicate data across a geological diverse area - which increases data availability.</p>
</div>
<div class="paragraph">
<p>In this exercise we will change the snitch and rack assignments for our two nodes. We will decommission each node (remove it from the cluster), reset the node&#8217;s data, etc.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-10"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) We will first clear out your current nodes.</p>
</div>
<div class="paragraph">
<p>2) Run the following commands to remove stop both nodes:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node2/resources/cassandra/bin/nodetool stopdaemon
/root/node1/resources/cassandra/bin/nodetool stopdaemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>These commands will take some time to complete.</p>
</div>
<div class="paragraph">
<p>3) For both nodes, delete all the files in the <code>data/</code> folder.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>rm -rf /root/node1/data
rm -rf /root/node2/data</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Edit <code>/root/node1/resources/cassandra/conf/cassandra.yaml</code> and find the <code>endpoint_snitch</code> setting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Using <code>endpoint_snitch</code> default DseSimpleSnitch places your node in a datacenter that is based upon work type
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># You can use a custom Snitch by setting this to the full class name
# of the snitch, which will be assumed to be on your classpath.
endpoint_snitch: com.datastax.bdp.snitch.DseSimpleSnitch</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Change the <code>endpoint_snitch</code> to <code>GossipingPropertyFileSnitch</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># You can use a custom Snitch by setting this to the full class name
# of the snitch, which will be assumed to be on your classpath.
endpoint_snitch: GossipingPropertyFileSnitch</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Save and close the <code>cassandra.yaml</code> file.</p>
</div>
<div class="paragraph">
<p>7) Make the same change to node 2&#8217;s <code>cassandra.yaml</code> file as well.</p>
</div>
<div class="paragraph">
<p>8) Edit <code>/root/node1/resources/cassandra/conf/cassandra-rackdc.properties</code> file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># These properties are used with GossipingPropertyFileSnitch and will
# indicate the rack and dc for this node
dc=dc1
rack=rack1</code></pre>
</div>
</div>
<div class="paragraph">
<p>This is the file that the <code>GossipingPropertyFileSnitch</code> uses to determine the rack and data center this particular node belongs to.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Racks and datacenters are purely logical assignments to Cassandra. You will want to ensure that your logical racks and data centers align with your physical failure zones.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>9) Change the <code>dc</code> to <code>west-side</code> and the <code>rack</code> to <code>hakuna-matata</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># These properties are used with GossipingPropertyFileSnitch and will
# indicate the rack and dc for this node
dc=west-side
rack=hakuna-matata</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) Save and close the <code>cassandra-rackdc.properties</code> file.</p>
</div>
<div class="paragraph">
<p>11) Edit <code>/root/node2/resources/cassandra/conf/cassandra-rackdc.properties</code> and change its <code>dc</code> to <code>east-side</code> and <code>rack</code> to <code>hakuna-matata</code>. Although the rack names between the two data centers are the same, each rack lives in a unique data center (west-side vs. east-side).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code># These properties are used with GossipingPropertyFileSnitch and will
# indicate the rack and dc for this node
dc=east-side
rack=hakuna-matata</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Start node1. Once it is up, start node2.</p>
</div>
<div class="paragraph">
<p>13) Once both nodes are up, execute:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/bin/dsetool status</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the differing datacenter assignments now.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DC: east-side       Workload: Cassandra       Graph: no
======================================================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--   Server ID          Address    Load    Owns  VNodes  Rack          Health [0,1]
UN   02-2C-EA-37-CE-A7  127.0.0.2  110 KB  ?     128     hakuna-matata 0.00

DC: west-side       Workload: Cassandra       Graph: no
======================================================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--   Server ID          Address    Load      Owns  VNodes  Rack          Health [0,1]
UN   02-2C-EA-37-CE-A7  127.0.0.1  95.99 KB  ?     128     hakuna-matata 0.00</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-11">Exercise 11: Replication</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-10"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand replication</p>
</li>
<li>
<p>Understand how replication aides in reliability</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-10"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Cassandra provides scalability and fault tolerance. Replication is the secret-sauce that makes this work.
In this exercise we will add a third node to our cluster and experiment with replication settings.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-11"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) In your terminal, extract the tarball again to make a third node by executing the following commands (be sure you are in the <code>/root/</code> directory).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tar -xf dse-5.0.3.tar.gz
mv dse-5.0.3 node3
labwork/config_node 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Ensure that both of your previous two nodes are up. We need to configure this new third node to play nicely with these other nodes already running on your machine.</p>
</div>
<div class="paragraph">
<p>3) Edit <code>/root/node3/resources/cassandra/conf/cassandra.yaml</code>. Change <code>num_tokens</code> to 128 and comment out <code>initial_token</code>.</p>
</div>
<div class="paragraph">
<p>4) Change the <code>endpoint_snitch</code> to <code>GossipingPropertyFileSnitch</code>. Save your changes and exit the editor.</p>
</div>
<div class="paragraph">
<p>5) Now, edit <code>/root/node3/resources/cassandra/conf/cassandra-rackdc.properties</code>. Change the <code>dc</code> to <code>west-side</code> and the <code>rack</code> to <code>hakuna-matata</code>. Save and close the file.</p>
</div>
<div class="paragraph">
<p>6) Start your third node by executing <code>/root/node3/bin/dse cassandra</code>.</p>
</div>
<div class="paragraph">
<p>7) Once the node is up, ensure all three nodes are in your cluster by executing <code>/root/node1/bin/dsetool status</code>. (You can use any node&#8217;s dsetool to do this if you like.)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DC: east-side       Workload: Cassandra       Graph: no
======================================================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--   Server ID          Address    Load    Owns  VNodes  Rack          Health [0,1]
UN   02-2C-EA-37-CE-A7  127.0.0.2  110 KB  ?     128     hakuna-matata 0.40

DC: west-side       Workload: Cassandra       Graph: no
======================================================
Status=Up/Down
|/ State=Normal/Leaving/Joining/Moving
--   Server ID          Address    Load      Owns  VNodes  Rack          Health [0,1]
UN   02-2C-EA-37-CE-A7  127.0.0.1  95.99 KB  ?     128     hakuna-matata 0.40
UN   02-2C-EA-37-CE-A7  127.0.0.3  86.47 KB  ?     128     hakuna-matata 0.40</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Now we will re-import our KillVideo data. Open <code>cqlsh</code>. Execute the following CQL CREATE KEYSPACE statement to use <code>NetworkTopologyStrategy</code> with replication set to store one replica per data center:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CREATE KEYSPACE killrvideo
WITH replication = {
    'class': 'NetworkTopologyStrategy',
    'east-side': 1,
    'west-side': 1
};</code></pre>
</div>
</div>
<div class="paragraph">
<p>9) Switch to the <code>killrvideo</code> keyspace.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) Now let&#8217;s recreate our <code>videos_by_tag</code> table and re-import the data. Execute the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CREATE TABLE videos_by_tag (
    tag text,
    video_id uuid,
    added_date timestamp,
    title text,
    PRIMARY KEY ((tag), added_date, video_id))
    WITH CLUSTERING ORDER BY (added_date DESC);</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>COPY videos_by_tag(tag, video_id, added_date, title)
FROM '/root/labwork/data-files/videos-by-tag.csv'
WITH HEADER=TRUE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Let&#8217;s determine which nodes our replicas ended up on. Execute the following commands in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'
/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'datastax'</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<code>nodetool</code> displays the IP addresses of the nodes containing our data.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'
127.0.0.3
127.0.0.2
root@node0:~# /root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'datastax'
127.0.0.3
127.0.0.2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice Cassandra stores each replica twice, and each replica is in a different data center. Your results may vary due to randomness in choosing tokens for vnodes.</p>
</div>
<div class="paragraph">
<p>12) Cassandra doesn&#8217;t have to have an actual partition with a key value to determine which nodes will store that partition. You can try any partition key value you like. For example, try the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'action'
/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'horror'</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-12">Exercise 12: Consistency Levels</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-11"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand the differences between consistency vs. replication factor.</p>
</li>
<li>
<p>Understand the differences of consistency on a write vs. a read.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-11"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>One of the challenges of distributed systems like Cassandra, is how to keep the data replicas consistent. Maintaining consistency requires balancing availability and partitioning. Fortunately, Cassandra lets you tune this balancing to your needs.</p>
</div>
<div class="paragraph">
<p>In this exercise we will tinker with consistency levels using operations that read and write.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-12"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Ensure all three of your nodes are up. Then start <code>cqlsh</code> and switch to the <code>killrvideo</code> keyspace by executing the command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) Now check the current consistency level by executing the CONSISTENCY command as we have it written out for you here:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that consistency is ONE; meaning only one node must acknowledge a write on a write request, and only one node must return a result set to satisfy a read request.</p>
</div>
<div class="paragraph">
<p>3) Set your consistency level to TWO by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY TWO;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
In this case, <code>TWO</code> is the same as <code>ALL</code> because our current replication settings store one replica per data center, and we have two data centers.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>4) Retrieve the <code>cassandra</code> partition from the <code>videos_by_tag</code> table by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query succeeds.</p>
</div>
<div class="paragraph">
<p>5) Determine which nodes hold the replicas for the <code>cassandra</code> partition tag value in the <code>videos_by_tag</code> table by executing the following command at the terminal prompt:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Bring one of the nodes down by executing:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/nodeX/resources/cassandra/bin/nodetool stopdaemon</code></pre>
</div>
</div>
<div class="paragraph">
<p>where X is the node number. Note the node number correlates with the last value in the IP address listed in your terminal. Track which node it is that you brought down and also the node number that is still up.</p>
</div>
<div class="paragraph">
<p>7) Again retrieve the <code>cassandra</code> partition by executing the following command in <code>cqlsh</code> (Note that you may have already executed the first two of these commands, but we include them in case you had to exit CQLSH. At any rate, it will not hurt to run them again):</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
By default, <code>cqlsh</code> connects to 127.0.0.1. If you ever bring down this node, you must tell <code>cqlsh</code> to connect to a different node by writing <code>./cqlsh 127.0.0.X</code> where X is the number of the node you are connecting to.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>USE killrvideo;

CONSISTENCY TWO;

SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query will error out because you cannot achieve a consistency level of TWO since we took one of the needed nodes down.</p>
</div>
<div class="paragraph">
<p>8) Set the consistency level back to one:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>9) Now retry your query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query succeeds because we still have one replica node available.</p>
</div>
<div class="paragraph">
<p>10) Change the consistency level back to two:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY TWO;</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Let&#8217;s try inserting a new row into the <code>cassandra</code> partition by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO killrvideo.videos_by_tag (tag, added_date, video_id, title)
VALUES ('cassandra', '2016-2-8', uuid(), 'Me Lava Cassandra');</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the write failed because we still cannot achieve a consistency level of two.</p>
</div>
<div class="paragraph">
<p>12) Change the consistency level back to ONE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>13) Now try the INSERT again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO videos_by_tag (tag, added_date, video_id, title)
VALUES ('cassandra', '2016-2-8', uuid(), 'Me Lava Cassandra');</code></pre>
</div>
</div>
<div class="paragraph">
<p>The write succeeds.</p>
</div>
<div class="paragraph">
<p>14) Now restart the node you took down. Wait for it to finish starting up before continuing.</p>
</div>
<div class="paragraph">
<p>15) Open <code>cqlsh</code> again and set your consistency level back to TWO:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY TWO;</code></pre>
</div>
</div>
<div class="paragraph">
<p>16) Now run the SELECT command again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the new record is present. This is due to read repair which will explore later.</p>
</div>
<div class="paragraph">
<p>17) Now, let&#8217;s have a little fun. Change your consistency level back to ONE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>18) Now bring down the other node that was up when we originally did our write. Wait for the node to terminate before continuing.</p>
</div>
<div class="paragraph">
<p>19) Start <code>cqlsh</code> again and re-execute the SELECT command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the query succeeds and the new record is still present. Again, this is because of read repair, which we will explore later.</p>
</div>
<div class="paragraph">
<p>20) Update the record to a new title by executing the CQL command that follows. You will have to copy and paste the video_id from the result set above into the UPDATE&#8217;s WHERE clause.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>UPDATE killrvideo.videos_by_tag
SET title = 'Me LovEEEEEEEE Cassandra'
WHERE tag = 'cassandra' AND added_date = '2016-02-08' AND video_id = paste_your_video_id;</code></pre>
</div>
</div>
<div class="paragraph">
<p>21) Run the following SELECT command to ensure your update succeeded:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>22) Now, bring down the node containing your replica. Keep track of which node this is. Wait for the node to terminate before continuing. Use either <code>dsetool</code> or <code>nodetool</code> to verify that both of your replica nodes are down (the nodes responsible for the 'cassandra' tag).</p>
</div>
<div class="paragraph">
<p>23) Now bring up the other replica node (the one you didn&#8217;t barely shut down). Wait for the node to start up before continuing.</p>
</div>
<div class="paragraph">
<p>24) Now execute the following SELECT command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Your video title may be <code>Me Lava Cassandra</code> or <code>Me LovEEEEEEEE Cassandra</code> depending on which nodes acted as coordinator on the previous writes and whether they performed hinted handoffs. More on this to come.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-13">Exercise 13: Hinted-handoff</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-12"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Observe how hinted-handoff keeps Cassandra write-data consistent</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-12"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Availability can affect data consistency. Hinted-handoff helps Cassandra maintain consistency even when a node is down.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-13"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Ensure that all your nodes are up before beginning this exercise.</p>
</div>
<div class="paragraph">
<p>2) Determine which nodes are responsible for the <code>cassandra</code> partition in <code>videos_by_tag</code> by executing the following command in the terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Bring down both of those nodes. Wait for them to terminate before continuing.</p>
</div>
<div class="paragraph">
<p>4) Switch to the killrvideo keyspace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>USE killrvideo;</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Change your consistency level to ANY:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ANY;</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When a client writes with <code>Consistency ANY</code>, storing a hint is sufficient for the write to be successful. <code>Consistency ONE</code> requires that at least one successful node write - a hint is not sufficient.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>6) Execute the following INSERT command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO videos_by_tag(tag, added_date, video_id, title)
VALUES ('cassandra', '2016-2-11', uuid(), 'Cassandra, Take Me Home');</code></pre>
</div>
</div>
<div class="paragraph">
<p>The write will succeed even though both replica nodes are down. The one and only node left in the cluster stores the writes as hints for the two replica nodes until they come back online.</p>
</div>
<div class="paragraph">
<p>7) You can see that the single node (i.e., the node still running) stored a hint by navigating to its <code>/root/nodeX/data/hints/</code> directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# ls -l /root/node1/data/hints/
total 8
-rw-r--r-- 1 root root 163 Nov  1 22:11 1f15ad1d-9865-4cd2-bd66-a...2-1478038274220-1.hints
-rw-r--r-- 1 root root 163 Nov  1 22:11 b56bb884-fb3d-4256-9e36-d...a-1478038274217-1.hints</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are two files, each storing all the hints for a single node.</p>
</div>
<div class="paragraph">
<p>8) You may also want to try navigating to the other node hints directory and confirm that they are empty (meaning neither is storing hints).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# ls -l /root/node2/data/hints/
total 0
root@node0:~# ls -l /root/node3/data/hints/
total 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>9) Set your consistency level back to ONE:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) Try reading the new record back by executing the following SELECT command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query fails because even though one node is up, that node doesn&#8217;t cover the entire token range itself. So, Cassandra cannot be sure that all records will be accounted for even with a consistency level of ONE.</p>
</div>
<div class="paragraph">
<p>11) Bring one replica node back up. Wait for <code>state jump to normal</code> before continuing. Investigate the <code>hints/</code> directory. You will see that one of the hint files has disappeared. This is due to this node forwarding the hints to the newly bootstrapped node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# ls -l /root/node1/data/hints/
total 4
-rw-r--r-- 1 root root 163 Nov  1 22:11 b56bb884-fb3d-4256-9e36-d...a-1478038274217-1.hints</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Now try the SELECT command one more time:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag;</code></pre>
</div>
</div>
<div class="paragraph">
<p>The query succeeds and also returns our new row.</p>
</div>
<div class="paragraph">
<p>13) Now bring up the remaining offline node. Wait for <code>state jump to normal</code> before proceeding.</p>
</div>
<div class="paragraph">
<p>Again you will notice some file activity in the <code>hints/</code> folder, and eventually the folder will clear.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# ls -l /root/node1/data/hints/
total 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Thus, the two replica nodes now each have their hinted records.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
Pre-Cassandra 3.0 versions stored their hints in actual tables.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>14) Execute the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM system.hints;</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will always get an empty result set in Cassandra 3.0+. Had this been an earlier version of Cassandra (pre 3.0), there would be no <code>hints/</code> folder. Instead, the hints would be in this table. However, storing hints in a file is optimal. You can read more about this here: <a class="bare" href="http://www.datastax.com/dev/blog/whats-coming-to-cassandra-in-3-0-improved-hint-storage-and-delivery">http://www.datastax.com/dev/blog/whats-coming-to-cassandra-in-3-0-improved-hint-storage-and-delivery</a></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-14">Exercise 14: Read Repair</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-13"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand how Cassandra performs read-repairs on inconsistent data.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-13"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Consistency is the tricky challenge for distributed systems. As distributed systems trade-off consistency for performance, some of the nodes in a cluster may become inconsistent. When Cassandra notices these inconsistencies, Cassandra takes steps to resolve the consistencies. This resolution is the role of Read-Repair.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-14"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Ensure that all three of your nodes are up and running.</p>
</div>
<div class="paragraph">
<p>2) We are going to bring down one of the nodes responsible for the <code>cassandra</code> replica. As a review, the following command will tell you what nodes these are:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node1/resources/cassandra/bin/nodetool getendpoints killrvideo videos_by_tag 'cassandra'</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure you have these written down.</p>
</div>
<div class="paragraph">
<p>3) Choose one of the nodes to bring down. Before bringing the node down, flush its data by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/nodeX/resources/cassandra/bin/nodetool drain</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Now bring down your chosen node responsible for the <code>cassandra</code> replica. Wait for the node to terminate before continuing.</p>
</div>
<div class="paragraph">
<p>Keep track of which node you brought down.</p>
</div>
<div class="paragraph">
<p>5) In the <code>/root/nodeX/data/data/</code> folder of the downed node, find the directory that contains the table data for <code>videos_by_tag</code>. Delete the entire directory.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@machine:~/nodeX/data/data/killrvideo# ls -l
total 4
drwxr-xr-x 3 root root 4096 Oct 31 17:21 videos_by_tag-92bd1ce19d5f11e6b482679521d87ee2
root@node0:~/nodeX/data/data/killrvideo# rm -rf videos_by_tag-92bd1ce19d5f11e6b482679521d87ee2/</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Start <code>cqlsh</code> on one of your up and running nodes. Ensure that your consistency level is set to ONE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>7) Execute the following query. What results do you expect back?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>We get all the data back because the replica node for the <code>cassandra</code> partition is up and still has the data. The query did not fail because our consistency level is ONE.</p>
</div>
<div class="paragraph">
<p>8) Take down the other node that is responsible for the <code>cassandra</code> partition in the <code>videos_by_tag</code> table. Wait for it to terminate before continuing.</p>
</div>
<div class="paragraph">
<p>9) Now bring up the downed node (the one you deleted the data files for). Wait for the node to come up before continuing.</p>
</div>
<div class="paragraph">
<p>10) In <code>cqlsh</code>, execute the query that follows. What do you think the results will be?</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>The result is empty because we deleted the data files on that node for <code>videos_by_tag</code>.</p>
</div>
<div class="paragraph">
<p>11) Bring up the other downed node. Wait for it to come online. Keep track of which node this is as we will take it down again shortly after triggering a read repair. Remember that this node you are bringing up still has all of our data for the <code>cassandra</code> partition.</p>
</div>
<div class="paragraph">
<p>12) In <code>cqlsh</code>, set your consistency level to two.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY TWO;</code></pre>
</div>
</div>
<div class="paragraph">
<p>A consistency level of two will cause Cassandra to read both replicas, perform the checksum diff, and notice the data is not in sync between the two nodes. Cassandra will then invoke a read repair to repair the node from which we deleted the data.</p>
</div>
<div class="paragraph">
<p>13) Execute the following query:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Our data is back.</p>
</div>
<div class="paragraph">
<p>14) Now bring down the node you just barely brought up&#8212;&#8203;the node which you did NOT delete the data files for <code>videos_by_tag</code>.</p>
</div>
<div class="paragraph">
<p>15) In <code>cqlsh</code>, ensure your consistency is ONE.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CONSISTENCY ONE;</code></pre>
</div>
</div>
<div class="paragraph">
<p>16) Execute the following query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>SELECT *
FROM killrvideo.videos_by_tag
WHERE tag = 'cassandra';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that, this time, we get our data from this node because the previous invocation of the query caused a read repair.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-15">Exercise 15: Write Path</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-14"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand Cassandra&#8217;s write path.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-14"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>Cassandra has an optimized write path. In order to understand how to use Cassandra, it can be very helpful to understand Cassandra&#8217;s write path.
In this exercise we will see Cassandra writing data to the file system.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-15"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Let&#8217;s simplify our cluster a bit. Shut down all three nodes and delete the folders <code>node1</code>, <code>node2</code> and <code>node3</code>.</p>
</div>
<div class="paragraph">
<p>2) Make a fresh new node by extracting it from the tarball by executing the following commands in the terminal from within the <code>/root</code> directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tar -xf dse-5.0.3.tar.gz
mv dse-5.0.3 node
labwork/config_node</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Now start this node.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Check the status of the running node <code>/root/node/bin/nodetool status</code>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
If the status shows two nodes and the second is DN, follow the instuctions on this link to remove the second node before proceeding: <a class="bare" href="https://docs.datastax.com/en/opscenter/5.1/opsc/online_help/opscRemovingPackages_t.html">https://docs.datastax.com/en/opscenter/5.1/opsc/online_help/opscRemovingPackages_t.html</a>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>5) Investigate the commitlog directory <code>ls -lh /root/node/data/commit-log</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# ls -lh /root/node/data/commit-log
total 76K
-rw-r--r-- 1 root root 32M Nov  1 23:06 CommitLog-6-1478040939739.log
-rw-r--r-- 1 root root 32M Nov  1 22:55 CommitLog-6-1478040939740.log</code></pre>
</div>
</div>
<div class="paragraph">
<p>Although each segment is allocated 32MB, that does not mean that there is 32MB of data written. Take note of the total on the first line of the command&#8217;s output, which is the true size of the files.</p>
</div>
<div class="paragraph">
<p>6) Let&#8217;s put a watch on this directory to see how it changes as we write data to Cassandra. Open a second terminal and ssh to the remote machine.</p>
</div>
<div class="paragraph">
<p>7) In the new terminal, execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>watch -n 1 -d "ls -lh /root/node/data/commit-log"</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
To exit the watch later, press CTRL-C
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>8) We will now use the <code>cassandra-stress</code> tool to write several thousand records to our node. Execute the following command in your original terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/tools/bin/cassandra-stress write no-warmup n=250000 -rate threads=1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Be sure your second terminal is also visible as <code>cassandra-stress</code> executes. <code>cassandra-stress</code> will write 250,000 rows to your node.</p>
</div>
<div class="paragraph">
<p>There are a few things to watch out for while keys are being inserted:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The total size will continue to increase.</p>
</li>
<li>
<p>The timestamp will change for the current segment being written.</p>
</li>
<li>
<p>You may get additional commit log files as well.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>9) When <code>cassandra-stress</code> completes, terminate the watch by pressing <code>CTRL-C</code>.</p>
</div>
<div class="paragraph">
<p>10) Execute the following <code>nodetool</code> command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/nodetool cfstats keyspace1.standard1</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>cassandra-stress</code> created the <code>keyspace1.standard1</code> table and populated its data. <code>cfstats</code> gives you column family stats. Column family is a deprecated term for a table.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node/bin/nodetool cfstats keyspace1.standard1
Keyspace: keyspace1
	Read Count: 0
	Read Latency: NaN ms.
	Write Count: 250000
	Write Latency: 0.040414532 ms.
	Pending Flushes: 0
		Table: standard1
		SSTable count: 2
		Space used (live): 52403218
		Space used (total): 52403218
		Space used by snapshots (total): 0
		Off heap memory used (total): 299966
		SSTable Compression Ratio: 0.0
		Number of keys (estimate): 250837
		Memtable cell count: 39058
		Memtable data size: 10897182
		Memtable off heap memory used: 0
		Memtable switch count: 2
		Local read count: 0
		Local read latency: NaN ms
		Local write count: 250000
		Local write latency: 0.037 ms
		Pending flushes: 0
		Bloom filter false positives: 0
		Bloom filter false ratio: 0.00000
		Bloom filter space used: 263704
		Bloom filter off heap memory used: 263688
		Index summary off heap memory used: 36278
		Compression metadata off heap memory used: 0
		Compacted partition minimum bytes: 180
		Compacted partition maximum bytes: 258
		Compacted partition mean bytes: 258
		Average live cells per slice (last five minutes): NaN
		Maximum live cells per slice (last five minutes): 0
		Average tombstones per slice (last five minutes): NaN
		Maximum tombstones per slice (last five minutes): 0</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the "Write Count" matches the number of rows we told <code>cassandra-stress</code> to insert. <code>cfstats</code> also reports the number of SSTables, space used, and bloom filter statistics.</p>
</div>
<div class="paragraph">
<p>11) Note the Memtable statistics.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Memtable cell count: 39058
Memtable data size: 10897182
Memtable off heap memory used: 0
Memtable switch count: 2</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Execute the following <code>nodetool</code> command which will flush the memtable contents to disk.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool flush</code></pre>
</div>
</div>
<div class="paragraph">
<p>13) Now check the table stats again by executing</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool cfstats keyspace1.standard1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the memtable statistics zeroed out because we flushed the previous memtable to disk.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>Memtable cell count: 0
Memtable data size: 0
Memtable off heap memory used: 0
Memtable switch count: 3</code></pre>
</div>
</div>
<div class="paragraph">
<p>14) Another simple exercise you can do is shut down your node, delete the <code>logs/system.log</code> file, restart your node, then search for <code>CommitLog.java</code> in the new <code>logs/system.log</code> file. You may see lines reporting replays.</p>
</div>
<div class="paragraph">
<p>If there were no commit log segments found during startup, no replay needs to be done. If Cassandra finds commit log files, it will replay the mutations in those files into memtables and then flush the memtables to disk.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-16">Exercise 16: Read Path</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-15"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand Cassandra&#8217;s read path.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-15"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>In this exercise, we will examine bloom filters and key caches.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-16"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) To begin, we need to populate our single-node cluster with a good chunk of data. We will use <code>cassandra-stress</code> to do so. Execute the following command in a terminal window. Wait for <code>cassandra-stress</code> to complete before continuing.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/tools/bin/cassandra-stress write no-warmup n=250000 -rate threads=2</code></pre>
</div>
</div>
<div class="paragraph">
<p>Take a visit to the water cooler while this runs. Catch up with your coworkers, shoot the bull, etc.</p>
</div>
<div class="paragraph">
<p>2) Now force Cassandra to flush its current memtable to disk by executing the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool flush</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) In your terminal, navigate to the data directory for the large table that <code>cassandra-stress</code> wrote. Remember that <code>cassandra-stress</code> creates a keyspace called <code>keyspace1</code> and a table called <code>standard1</code>. You will find the directory as illustrated below, however, your table ID will differ. Use the tab key in the terminal to use helpful autocompletion.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# cd /root/node/data/data/keyspace1/standard1-7a86...06c25300ad
root@node0:/root/node/data/data/keyspace1/standard1-7a86...06c25300ad#</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Use the following command to list the bloom filter files for your SSTables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ls -lh *Filter.db</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:/root/node/data/data/keyspace1/standard1-7a86...06c25300ad# ls -lh *Filter.db
-rw-r--r-- 1 root root 129K Nov  2 20:42 mc-1-big-Filter.db
-rw-r--r-- 1 root root 129K Nov  2 20:44 mc-2-big-Filter.db
-rw-r--r-- 1 root root  48K Nov  2 20:45 mc-3-big-Filter.db</code></pre>
</div>
</div>
<div class="paragraph">
<p>Take note of the file sizes.</p>
</div>
<div class="paragraph">
<p>We will now decrease the probability that a bloom filter will return a false positive and see how this affects the bloom filter files sizes.</p>
</div>
<div class="paragraph">
<p>5) Execute the following command to view the current bloom filter settings:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>DESCRIBE keyspace keyspace1;</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>cqlsh&gt; DESCRIBE keyspace keyspace1;

CREATE KEYSPACE keyspace1 WITH replication = {'class': 'SimpleStrategy', 'replication_factor': '1'}  AND durable_writes = true;

CREATE TABLE keyspace1.counter1 (
    key blob,
    column1 text,
    "C0" counter static,
    "C1" counter static,
    "C2" counter static,
    "C3" counter static,
    "C4" counter static,
    value counter,
    PRIMARY KEY (key, column1)
) WITH COMPACT STORAGE
    AND CLUSTERING ORDER BY (column1 ASC)
    AND bloom_filter_fp_chance = 0.01
    ...
    AND speculative_retry = '99PERCENTILE';

CREATE TABLE keyspace1.standard1 (
    key blob PRIMARY KEY,
    "C0" blob,
    "C1" blob,
    "C2" blob,
    "C3" blob,
    "C4" blob
) WITH COMPACT STORAGE
    AND bloom_filter_fp_chance = 0.01
    ...
    AND speculative_retry = '99PERCENTILE';</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note the <code>bloom_filter_fp_chance</code> is 0.01, meaning a 1% chance of a false positive. That&#8217;s pretty good, but if we want an even smaller chance, we can trade space for it.</p>
</div>
<div class="paragraph">
<p>6) Execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ALTER TABLE keyspace1.standard1 WITH bloom_filter_fp_chance = 0.0001;</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have changed the <code>bloom_filter_fp_chance</code>, we must update our SSTables and associated bloom filter files.</p>
</div>
<div class="paragraph">
<p>7) Switch back to your terminal window and execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool upgradesstables --include-all-sstables</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>nodetool upgradesstables</code> rebuilds SSTables for a specified keyspace and table. We are doing this here to rebuild the Bloom Filters also. Normally this command will only upgrade sstables if the sstables are not at the most recent SSTable version; the <code>--include-all-sstables</code> flag forces the rebuild to occur. Normally you would need to run <code>nodetool upgradesstables</code> on each node. For the purposes of this exercise, we only have one node.</p>
</div>
<div class="paragraph">
<p>8) Now examine the new size of your bloom filter files.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:/root/node/data/data/keyspace1/standard1-7a86...06c25300ad# ls -lh *Filter.db
-rw-r--r-- 1 root root  96K Nov  2 22:05 mc-4-big-Filter.db
-rw-r--r-- 1 root root 258K Nov  2 22:05 mc-5-big-Filter.db
-rw-r--r-- 1 root root 255K Nov  2 22:05 mc-6-big-Filter.db</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice the size of these files is larger. We traded space for a smaller chance of a false positive.</p>
</div>
<div class="paragraph">
<p>9) Now execute the following command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ALTER TABLE keyspace1.standard1 WITH bloom_filter_fp_chance = 1.0;</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) And update your SSTables once again in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool upgradesstables --include-all-sstables</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now what is the size of your bloom filter files? Why? :)</p>
</div>
<div class="paragraph">
<p>The files are gone! A bloom_filter_fp_chance = 1.0 means that no filtering is going on, so there is no need to store the filters.</p>
</div>
<div class="paragraph">
<p>11) Now execute the following command in your terminal:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool cfstats keyspace1.standard1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Part of the stats include bloom filter information. Since we have not read from the <code>cassandra-stress</code> tables, the values are all zero. However, you can use these stats to tune Cassandra if necessary.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>root@node0:~# /root/node/resources/cassandra/bin/nodetool cfstats keyspace1.standard1
Keyspace: keyspace1
	Read Count: 0
	Read Latency: NaN ms.
	Write Count: 250000
	Write Latency: 0.041335976 ms.
	Pending Flushes: 0
		Table: standard1
		SSTable count: 3
		Space used (live): 61790227
		Space used (total): 61790227
		Space used by snapshots (total): 0
		Off heap memory used (total): 43010
		SSTable Compression Ratio: 0.0
		Number of keys (estimate): 249256
		Memtable cell count: 0
		Memtable data size: 0
		Memtable off heap memory used: 0
		Memtable switch count: 7
		Local read count: 0
		Local read latency: NaN ms
		Local write count: 250000
		Local write latency: NaN ms
		Pending flushes: 0
		Bloom filter false positives: 0
		Bloom filter false ratio: 0.00000
		Bloom filter space used: 0
		Bloom filter off heap memory used: 0
		Index summary off heap memory used: 43010
		Compression metadata off heap memory used: 0
		Compacted partition minimum bytes: 180
		Compacted partition maximum bytes: 258
		Compacted partition mean bytes: 258
		Average live cells per slice (last five minutes): NaN
		Maximum live cells per slice (last five minutes): 0
		Average tombstones per slice (last five minutes): NaN
		Maximum tombstones per slice (last five minutes): 0</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="EXERCISE-17">Exercise 17: Compaction</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="strong-in-this-exercise-you-will-strong-16"><strong>In this exercise, you will:</strong></h3>
<div class="ulist">
<ul>
<li>
<p>Understand basic Cassandra compaction strategies.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-background-em-strong-16"><strong><em>Background</em></strong></h3>
<div class="paragraph">
<p>As memtables fill up, Cassandra writes them to disk in the form of SSTables. If this were the end of the story, the number of data files used to contain SSTables would become large and slow Cassandra&#8217;s read performance. Therefore, Cassandra must consolidate these files from time to time. This consolidation is called <code>compaction</code>.
In this exercise, we observe the effects of compaction.</p>
</div>
</div>
<div class="sect2">
<h3 id="strong-em-steps-em-strong-17"><strong><em>Steps</em></strong></h3>
<div class="paragraph">
<p>1) Let&#8217;s start with a fresh node. Shutdown the nodes from the previous exercise:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra-stop</code></pre>
</div>
</div>
<div class="paragraph">
<p>2) delete the node and its contents:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>rm -rf /root/node</code></pre>
</div>
</div>
<div class="paragraph">
<p>3) Now create a fresh node with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>tar -xf dse-5.0.3.tar.gz
mv dse-5.0.3 node
/root/labwork/config_node</code></pre>
</div>
</div>
<div class="paragraph">
<p>4) Bring up the node (be sure to wait for it to complete bootstrapping):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/dse cassandra</code></pre>
</div>
</div>
<div class="paragraph">
<p>5) Launch <code>cqlsh</code>. Let&#8217;s recreate the <code>killrvideo</code> keyspace and also create the <code>videos_by_tag</code> database:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>CREATE KEYSPACE killrvideo
WITH replication = {'class':'SimpleStrategy', 'replication_factor': 1};

USE killrvideo;

CREATE TABLE videos_by_tag (
  tag TEXT,
  video_id UUID,
  added_date TIMESTAMP,
  title TEXT,
  PRIMARY KEY ((tag), video_id)
);</code></pre>
</div>
</div>
<div class="paragraph">
<p>6) Now, let&#8217;s insert a single row into the table:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO videos_by_tag (tag, added_date, video_id, title)
    VALUES ('cassandra', dateof(now()), uuid(), 'Cassandra Master');</code></pre>
</div>
</div>
<div class="paragraph">
<p>7) Exit cqlsh and for Cassandra to flush the memtable to an SSTable:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/bin/nodetool flush</code></pre>
</div>
</div>
<div class="paragraph">
<p>8) Let&#8217;s investigate the SSTable in the node&#8217;s data directory. Remember the actual name of the directory will be a unique random value under <code>/root/node/data/data/killrvideo</code>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ls -l /root/node/data/data/killrvideo/videos_by_tag-*</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see several files with names that start with <code>mc-1-big-</code>. These are the files associated with the first SSTable.</p>
</div>
<div class="paragraph">
<p>9) We can create a second SSTable. Add a second row using the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO killrvideo.videos_by_tag (tag, added_date, video_id, title)
    VALUES ('cassandra', dateof(now()), uuid(), 'Cassandra Genius');</code></pre>
</div>
</div>
<div class="paragraph">
<p>10) Flush this second memtable to disk:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool flush</code></pre>
</div>
</div>
<div class="paragraph">
<p>11) Re-inspect the data directory to see the files associated with the <em>two</em> SSTables:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>ls -l /root/node/data/data/killrvideo/videos_by_tag-*</code></pre>
</div>
</div>
<div class="paragraph">
<p>12) Create a third SSTable by inserting the following row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO killrvideo.videos_by_tag (tag, added_date, video_id, title)
    VALUES ('cassandra', dateof(now()), uuid(), 'Cassandra Wizard');</code></pre>
</div>
</div>
<div class="paragraph">
<p>13) Once again, flush the memtable to disk and investigate the data directory:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool flush
ls -l /root/node/data/data/killrvideo/videos_by_tag-*</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
When Cassandra goes to create a fourth SSTable, Cassandra will perform compaction.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>14) Insert a fourth row:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>INSERT INTO killrvideo.videos_by_tag (tag, added_date, video_id, title)
    VALUES ('cassandra', dateof(now()), uuid(), 'Cassandra Ninja');</code></pre>
</div>
</div>
<div class="paragraph">
<p>15) Flush and investigate the data directory again:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code>/root/node/resources/cassandra/bin/nodetool flush
ls -l /root/node/data/data/killrvideo/videos_by_tag-*</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the three previous SSTable files are gone and a new set has appeared. Also, notice that the file names skipped from <code>mc-3-big</code> to <code>mc-5-big</code>. This new set is the result of the compaction. Cassandra created the fourth SSTable and then compacted all four into a fifth SSTable.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2017-03-03 14:49:41 PST
</div>
</div>
</body>
</html>